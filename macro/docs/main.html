<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>main.s</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl ppc">.data</span>
app_name<span class="hl opt">:</span> <span class="hl ppc">.asciz</span> <span class="hl pps">&quot;Macro&quot;</span><span class="hl ppc"></span>
app_description<span class="hl opt">:</span> <span class="hl ppc">.asciz</span> <span class="hl pps">&quot;Macro is a Nano-like app that lets you create, edit, and delete text files.&quot;</span><span class="hl ppc"></span>
untitled_string<span class="hl opt">:</span>
	<span class="hl ppc">.string</span>	<span class="hl pps">&quot;Untitled&quot;</span><span class="hl ppc"></span>
	<span class="hl ppc">.align	3</span>
empty_string<span class="hl opt">:</span>
	<span class="hl ppc">.string</span>	<span class="hl pps">&quot;&quot;</span><span class="hl ppc"></span>
	<span class="hl ppc">.text</span>
	<span class="hl ppc">.align	2</span>
<span class="hl com">/*</span>
<span class="hl com">  __  __       _       </span>
<span class="hl com"> |  \/  |     (_)      </span>
<span class="hl com"> | \  / | __ _ _ _ __  </span>
<span class="hl com"> | |\/| |/ _` | | &apos;_ \ </span>
<span class="hl com"> | |  | | (_| | | | | |</span>
<span class="hl com"> |_|  |_|\__,_|_|_| |_|</span>
<span class="hl com">                       </span>
<span class="hl com">*/</span>
<span class="hl ppc">.global	main</span>
<span class="hl ppc">.type	main, %function</span>
<span class="hl opt">//</span> main function
main<span class="hl opt">:</span>
    <span class="hl ppc">.LFB0:</span>
    <span class="hl ppc">.cfi_startproc</span>

    stp x29<span class="hl opt">,</span> x30<span class="hl opt">, [</span>sp<span class="hl opt">, -</span><span class="hl num">32</span><span class="hl opt">]!</span>
    <span class="hl ppc">.cfi_def_cfa_offset 32</span>
    <span class="hl ppc">.cfi_offset 29, -32</span>
    <span class="hl ppc">.cfi_offset 30, -24</span>
    mov x29<span class="hl opt">,</span> sp

    <span class="hl opt">//</span> Initialization
    <span class="hl kwa">bl</span>  initscr
    <span class="hl kwa">bl</span>  start_color
    mov w2<span class="hl opt">,</span> <span class="hl num">4</span>
    mov w1<span class="hl opt">,</span> <span class="hl num">7</span>
    mov w0<span class="hl opt">,</span> <span class="hl num">1</span>
    <span class="hl kwa">bl</span>  init_pair
    adrp    x0<span class="hl opt">, :</span>got<span class="hl opt">:</span>stdscr
    ldr x0<span class="hl opt">, [</span>x0<span class="hl opt">,</span> <span class="hl slc">#:got_lo12:stdscr]</span>
    ldr x0<span class="hl opt">, [</span>x0<span class="hl opt">]</span>
    mov w1<span class="hl opt">,</span> <span class="hl num">1</span>
    <span class="hl kwa">bl</span>  keypad
    <span class="hl kwa">bl</span>  cbreak
    <span class="hl kwa">bl</span>  noecho

main_loop<span class="hl opt">:</span>
    adrp    x0<span class="hl opt">,</span> app_description
    <span class="hl kwa">add</span> x1<span class="hl opt">,</span> x0<span class="hl opt">, :</span>lo12<span class="hl opt">:</span>app_description
    adrp    x0<span class="hl opt">,</span> app_name
    <span class="hl kwa">add</span> x0<span class="hl opt">,</span> x0<span class="hl opt">, :</span>lo12<span class="hl opt">:</span>app_name

    <span class="hl kwa">bl</span>  front_page
    str w0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl num">28</span><span class="hl opt">]</span>

    ldr w0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl num">28</span><span class="hl opt">]</span>
    <span class="hl kwa">cmp</span> w0<span class="hl opt">,</span> <span class="hl num">3</span>
    <span class="hl kwa">beq</span> exit

    ldr w0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl num">28</span><span class="hl opt">]</span>
    <span class="hl kwa">cmp</span> w0<span class="hl opt">,</span> <span class="hl num">3</span>
    <span class="hl kwa">bgt</span> main_loop

    ldr w0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl num">28</span><span class="hl opt">]</span>
    <span class="hl kwa">cmp</span> w0<span class="hl opt">,</span> <span class="hl num">1</span>
    <span class="hl kwa">beq</span> create_new_file

    ldr w0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl num">28</span><span class="hl opt">]</span>
    <span class="hl kwa">cmp</span> w0<span class="hl opt">,</span> <span class="hl num">2</span>
    <span class="hl kwa">beq</span> open_existing_file

main_loop_continue<span class="hl opt">:</span>
    <span class="hl kwa">b</span>   main_loop

<span class="hl opt">//</span> Create new file
create_new_file<span class="hl opt">:</span>
    adrp    x0<span class="hl opt">,</span> untitled_string
    <span class="hl kwa">add</span> x0<span class="hl opt">,</span> x0<span class="hl opt">, :</span>lo12<span class="hl opt">:</span>untitled_string
    <span class="hl kwa">bl</span>  text_editor
    <span class="hl kwa">b</span>   main_loop_continue

<span class="hl opt">//</span> Open existing file
open_existing_file<span class="hl opt">:</span>
    adrp    x0<span class="hl opt">,</span> empty_string
    <span class="hl kwa">add</span> x0<span class="hl opt">,</span> x0<span class="hl opt">, :</span>lo12<span class="hl opt">:</span>empty_string
    <span class="hl kwa">bl</span>  text_editor
    <span class="hl kwa">b</span>   main_loop_continue

<span class="hl opt">//</span> Exit application
exit<span class="hl opt">:</span>
    <span class="hl kwa">bl</span>  endwin
    mov w0<span class="hl opt">,</span> <span class="hl num">0</span>

main_cleanup<span class="hl opt">:</span>
    ldp x29<span class="hl opt">,</span> x30<span class="hl opt">, [</span>sp<span class="hl opt">],</span> <span class="hl num">32</span>
    <span class="hl ppc">.cfi_restore 30</span>
    <span class="hl ppc">.cfi_restore 29</span>
    <span class="hl ppc">.cfi_def_cfa_offset 0</span>
    ret
    <span class="hl ppc">.cfi_endproc</span>

main_end<span class="hl opt">:</span>
    <span class="hl ppc">.size   main, .-main</span>
    <span class="hl ppc">.section    .rodata</span>
    <span class="hl ppc">.align  3</span>
</pre>
</body>
</html>
<!--HTML generated by highlight 3.41, http://www.andre-simon.de/-->
