<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>main.s</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl opt">//</span> I wanted to <span class="hl kwa">be</span> different so I used length but it doesn<span class="hl str">&apos;t work properly it only prints &quot;Cat in&quot;...</span>
<span class="hl str">.data</span>
<span class="hl str">    szX: .asciz &quot;Cat         &quot;</span>
<span class="hl str">    szY: .asciz &quot;in the hat.&quot;</span>
<span class="hl str">    ptr: .quad 0</span>
<span class="hl str">    nl: .asciz &quot;</span><span class="hl esc">\n</span><span class="hl str">&quot;</span>
<span class="hl str"></span>
<span class="hl str">.text</span>
<span class="hl str">.global main</span>
<span class="hl str">    main:</span>
<span class="hl str">        // Calculate the length of szX and szY</span>
<span class="hl str">        ldr x0, =szX</span>
<span class="hl str">        bl length</span>
<span class="hl str">        sub x4, x0, #1</span>
<span class="hl str"></span>
<span class="hl str">        ldr x0, =szY</span>
<span class="hl str">        bl length</span>
<span class="hl str">        mov x5, x0</span>
<span class="hl str"></span>
<span class="hl str">        // Calculate the total size needed (plus one byte for null terminator)</span>
<span class="hl str">        add x0, x4, x5</span>
<span class="hl str">        add x0, x0, #1</span>
<span class="hl str">        bl malloc</span>
<span class="hl str">        ldr x1, =ptr</span>
<span class="hl str">        str x0, [x1]</span>
<span class="hl str"></span>
<span class="hl str">        // Set destination and source pointers for custom_memcpy</span>
<span class="hl str">        ldr x19, =ptr</span>
<span class="hl str">        ldr x19, [x19]</span>
<span class="hl str">        ldr x20, =szX</span>
<span class="hl str">        mov x21, x4</span>
<span class="hl str"></span>
<span class="hl str">        // Copy szX to the allocated memory</span>
<span class="hl str">        bl custom_memcpy</span>
<span class="hl str"></span>
<span class="hl str">        // Set destination and source pointers for custom_memcpy</span>
<span class="hl str">        ldr x19, =ptr</span>
<span class="hl str">        ldr x19, [x19]</span>
<span class="hl str">        add x19, x19, x4</span>
<span class="hl str">        ldr x20, =szY</span>
<span class="hl str">        mov x21, x5</span>
<span class="hl str"></span>
<span class="hl str">        // Copy szY to the allocated memory after szX</span>
<span class="hl str">        bl custom_memcpy</span>
<span class="hl str"></span>
<span class="hl str">        // Add null terminator to the end of the combined string</span>
<span class="hl str">        mov w3, #0</span>
<span class="hl str">        strb w3, [x19], #1</span>
<span class="hl str"></span>
<span class="hl str">        // Print the concatenated string</span>
<span class="hl str">        ldr x0, =ptr</span>
<span class="hl str">        ldr x0, [x0]</span>
<span class="hl str">        bl putstring</span>
<span class="hl str"></span>
<span class="hl str">        // Print a newline character</span>
<span class="hl str">        ldr x0, =nl</span>
<span class="hl str">        bl putstring</span>
<span class="hl str"></span>
<span class="hl str">        // Free allocated memory</span>
<span class="hl str">        ldr x0, =ptr</span>
<span class="hl str">        ldr x0, [x0]</span>
<span class="hl str">        bl free</span>
<span class="hl str"></span>
<span class="hl str">        // Exit the program</span>
<span class="hl str">        mov x0, 0       // Move 0 to x0 to indicate successful termination</span>
<span class="hl str">        mov x8, #93     // Set x8 to 93 to indicate the &quot;exit&quot; system call</span>
<span class="hl str">        svc 0           // Call the &quot;exit&quot; system call to terminate the program</span>
<span class="hl str"></span>
<span class="hl str">/**</span>
<span class="hl str"> * custom_memcpy - copies memory from source to destination</span>
<span class="hl str"> * &#64;param x19: pointer to the destination</span>
<span class="hl str"> * &#64;param x20: pointer to the source</span>
<span class="hl str"> * &#64;param x21: number of bytes to copy</span>
<span class="hl str"> */</span>
<span class="hl str">.global custom_memcpy</span>
<span class="hl str">    custom_memcpy:</span>
<span class="hl str">        cbz x21, memcpy_done // If x21 is 0, there&apos;</span>s nothing to copy; return
    memcpy_loop<span class="hl opt">:</span>
        ldrb w3<span class="hl opt">, [</span>x20<span class="hl opt">],</span> <span class="hl slc">#1    // Load a byte from source (x20) and increment x20</span>
        strb w3<span class="hl opt">, [</span>x19<span class="hl opt">],</span> <span class="hl slc">#1    // Store the byte to destination (x19) and increment x19</span>
        subs x21<span class="hl opt">,</span> x21<span class="hl opt">,</span> <span class="hl slc">#1     // Decrement the count (x21)</span>
        b.ne memcpy_loop      <span class="hl opt">//</span> If x21 is <span class="hl kwa">not</span> <span class="hl num">0</span><span class="hl opt">,</span> continue copying bytes
    memcpy_done<span class="hl opt">:</span>
        ret

<span class="hl com">/**</span>
<span class="hl com"> * length - calculates the length of a null-terminated string</span>
<span class="hl com"> * &#64;param x0: pointer to the beginning of the string</span>
<span class="hl com"> * &#64;return: the length of the string (excluding the null terminator)</span>
<span class="hl com"> */</span>
<span class="hl ppc">.global length</span>
length<span class="hl opt">:</span>
    mov x1<span class="hl opt">,</span> x0          <span class="hl opt">//</span> Copy pointer to x1
    length_loop<span class="hl opt">:</span>
        ldrb w2<span class="hl opt">, [</span>x0<span class="hl opt">],</span> <span class="hl slc">#1    // Load a byte from the string (x0) and increment x0</span>
        cbz w2<span class="hl opt">,</span> length_done  <span class="hl opt">//</span> If the byte is null<span class="hl opt">,</span> return
        <span class="hl kwa">b</span> length_loop        <span class="hl opt">//</span> Otherwise<span class="hl opt">,</span> continue looping
    length_done<span class="hl opt">:</span>
        <span class="hl kwa">sub</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> x1      <span class="hl opt">//</span> Subtract the starting pointer from the current pointer
        <span class="hl kwa">sub</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> <span class="hl slc">#1       // Subtract 1 from the result to exclude the null terminator</span>
        ret
</pre>
</body>
</html>
<!--HTML generated by highlight 3.41, http://www.andre-simon.de/-->
