<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>putstr.s</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl com">/**</span>
<span class="hl com"> * putstr - Prints a null-terminated string using write syscall</span>
<span class="hl com"> * </span>
<span class="hl com"> * &#64;param x0: Pointer to the null-terminated string</span>
<span class="hl com"> *</span>
<span class="hl com"> * Registers used: x0, x2, x30, lr</span>
<span class="hl com"> * Registers saved: lr</span>
<span class="hl com"> */</span>

<span class="hl ppc">.text</span>
<span class="hl ppc">.global putstr</span>
    putstr<span class="hl opt">:</span>
        <span class="hl opt">//</span> Save the link register
        str <span class="hl kwb">lr</span><span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl slc">#-16]!</span>

        <span class="hl opt">//</span> Prepare parameters for the `write` syscall
        mov x2<span class="hl opt">,</span> <span class="hl slc">#0</span>
        <span class="hl opt">//</span> Get the string length
    loop<span class="hl opt">:</span>
        ldrb w1<span class="hl opt">, [</span>x0<span class="hl opt">,</span> x2<span class="hl opt">]</span>
        cbz w1<span class="hl opt">,</span> out
        <span class="hl kwa">add</span> x2<span class="hl opt">,</span> x2<span class="hl opt">,</span> <span class="hl slc">#1</span>
        <span class="hl kwa">b</span> loop
    out<span class="hl opt">:</span>
        mov x8<span class="hl opt">,</span> <span class="hl slc">#64</span>
        mov x1<span class="hl opt">,</span> x0
        mov w0<span class="hl opt">,</span> <span class="hl slc">#1</span>
        <span class="hl kwa">svc</span> <span class="hl num">0</span>
        
        <span class="hl opt">//</span> Restore the link register
        ldr <span class="hl kwb">lr</span><span class="hl opt">, [</span>sp<span class="hl opt">],</span> <span class="hl slc">#16</span>
        
        ret
</pre>
</body>
</html>
<!--HTML generated by highlight 3.41, http://www.andre-simon.de/-->
