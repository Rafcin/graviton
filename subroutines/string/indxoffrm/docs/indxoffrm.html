<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>indxoffrm.s</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl com">/**</span>
<span class="hl com"> * indxoffrm - Returns the index of the first occurrence of character ch in the given string </span>
<span class="hl com"> *             after the specified index &quot;fromIndex&quot;.</span>
<span class="hl com"> * </span>
<span class="hl com"> * &#64;param x0: Address of the target string to search.</span>
<span class="hl com"> * &#64;param x1: Character to find in the target string.</span>
<span class="hl com"> * &#64;param x2: Index to start the search in the target string.</span>
<span class="hl com"> * </span>
<span class="hl com"> * &#64;return x0: Integer index of the first occurrence of character ch in the target string </span>
<span class="hl com"> *             after the specified index &quot;fromIndex&quot;. If the character is not found, </span>
<span class="hl com"> *             returns -1.</span>
<span class="hl com"> *</span>
<span class="hl com"> * This function searches for the first occurrence of the specified character ch in the </span>
<span class="hl com"> * target string starting from the specified index &quot;fromIndex&quot; onwards. The function returns </span>
<span class="hl com"> * the index of the first occurrence of the character ch in the target string after the </span>
<span class="hl com"> * specified index &quot;fromIndex&quot;. The search starts from the index x2+1 in the target string, </span>
<span class="hl com"> * where x2 is the specified index &quot;fromIndex&quot;. The function returns -1 if the character ch </span>
<span class="hl com"> * is not found in the target string.</span>
<span class="hl com"> *</span>
<span class="hl com"> * Registers used: x0, x1, x2, w2</span>
<span class="hl com"> * Registers saved: none</span>
<span class="hl com"> */</span>

<span class="hl ppc">.text</span>
<span class="hl ppc">.global indxoffrm</span>
    indxoffrm<span class="hl opt">:</span>
        <span class="hl opt">//</span> Save the target string pointer on the stack
        str x0<span class="hl opt">, [</span>sp<span class="hl opt">,</span> <span class="hl slc">#-16]!</span>
        
        <span class="hl opt">//</span> Calculate the starting index for the search
        <span class="hl kwa">add</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> x2
        <span class="hl kwa">add</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> <span class="hl slc">#1</span>
        
    loop<span class="hl opt">:</span>
        <span class="hl opt">//</span> Load <span class="hl kwa">a</span> byte from the target string
        ldrb w2<span class="hl opt">, [</span>x0<span class="hl opt">],</span> <span class="hl slc">#1</span>
        
        <span class="hl opt">//</span> Check if the byte is the terminating null byte
        <span class="hl kwa">cmp</span> w2<span class="hl opt">,</span> <span class="hl slc">#0</span>
        b.eq error
        
        <span class="hl opt">//</span> Check if the byte is the character to find
        <span class="hl kwa">cmp</span> w2<span class="hl opt">,</span> w1
        b.eq found
        
        <span class="hl opt">//</span> Jump back to the beginning of the loop
        <span class="hl kwa">b</span> loop
    
    found<span class="hl opt">:</span>
        <span class="hl opt">//</span> Restore the target string pointer from the stack
        ldr x1<span class="hl opt">, [</span>sp<span class="hl opt">],</span> <span class="hl slc">#16</span>
        
        <span class="hl opt">//</span> Calculate <span class="hl kwa">and</span> return the index of the found character
        <span class="hl kwa">sub</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> x1
        <span class="hl kwa">sub</span> x0<span class="hl opt">,</span> x0<span class="hl opt">,</span> <span class="hl slc">#1</span>
        ret
    
    error<span class="hl opt">:</span>
        <span class="hl opt">//</span> Remove the saved target string pointer from the stack
        <span class="hl kwa">add</span> sp<span class="hl opt">,</span> sp<span class="hl opt">,</span> <span class="hl slc">#16</span>
        
        <span class="hl opt">//</span> Return <span class="hl opt">-</span><span class="hl num">1</span> to indicate that the character was <span class="hl kwa">not</span> found
        mov x0<span class="hl opt">,</span> <span class="hl slc">#-1</span>
        ret
</pre>
</body>
</html>
<!--HTML generated by highlight 3.41, http://www.andre-simon.de/-->
