<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>length.s</title>
<link rel="stylesheet" type="text/css" href="highlight.css">
</head>
<body class="hl">
<pre class="hl"><span class="hl com">/**</span>
<span class="hl com"> * length - counts the number of characters in a string</span>
<span class="hl com"> * &#64;param x0: pointer to the string to count</span>
<span class="hl com"> * &#64;param x1: maximum number of characters to count</span>
<span class="hl com"> * &#64;return x0: number of characters counted, including null terminator</span>
<span class="hl com"> *</span>
<span class="hl com"> * This function counts the number of characters in a string pointed to by x0, up</span>
<span class="hl com"> * to a maximum of x1 characters. The count includes the null terminator. If the</span>
<span class="hl com"> * string is longer than x1 characters, the function stops counting at x1</span>
<span class="hl com"> * characters.</span>
<span class="hl com"> *</span>
<span class="hl com"> * Registers used: x0, x1, x2, x3, w3</span>
<span class="hl com"> * Registers saved: x19-x30, lr</span>
<span class="hl com"> */</span>

<span class="hl ppc">.text</span>
<span class="hl ppc">.global length</span>

<span class="hl opt">//</span> Entry point for the `length` subroutine
length<span class="hl opt">:</span>
    <span class="hl opt">//</span> Save the input string pointer
    mov x9<span class="hl opt">,</span> x0

    <span class="hl opt">//</span> Initialize the counter to zero
    mov x2<span class="hl opt">,</span> <span class="hl slc">#0</span>

<span class="hl opt">//</span> Top of the loop to count characters
top<span class="hl opt">:</span>
    <span class="hl opt">//</span> Load the next byte of the string
    ldrb w1<span class="hl opt">, [</span>x9<span class="hl opt">,</span> x2<span class="hl opt">]</span>

    <span class="hl opt">//</span> Check if the byte is the null terminator
    <span class="hl kwa">cmp</span> w1<span class="hl opt">,</span> <span class="hl slc">#0</span>

    <span class="hl opt">//</span> If the byte is the null terminator<span class="hl opt">,</span> jump to the bottom of the loop
    b.eq bottom

    <span class="hl opt">//</span> Increment the counter by one
    <span class="hl kwa">add</span> x2<span class="hl opt">,</span> x2<span class="hl opt">,</span> <span class="hl slc">#1</span>

    <span class="hl opt">//</span> Jump back to the top of the loop
    <span class="hl kwa">b</span> top

<span class="hl opt">//</span> Bottom of the loop to return the length
bottom<span class="hl opt">:</span>
    <span class="hl opt">//</span> Return the length of the string<span class="hl opt">,</span> including the null terminator
    mov x0<span class="hl opt">,</span> x2
    ret
</pre>
</body>
</html>
<!--HTML generated by highlight 3.41, http://www.andre-simon.de/-->
